Ecco il nome del file numero 1:
--- ContentView.swift ---
Contenuto del file numero 1:
---
import SwiftUI
import ReplayKit

struct ContentView: View {
    @State private var isRecording = false
    private let screenRecorder = RPScreenRecorder.shared()
    
    var body: some View {
        VStack {
            Text(isRecording ? "Stop Screencast" : "Start Screencast")
                .font(.title)
                .padding()
                .background(isRecording ? Color.red : Color.green)
                .foregroundColor(.white)
                .cornerRadius(10)
                .onTapGesture {
                    if isRecording {
                        stopRecording()
                    } else {
                        startRecording()
                    }
                }
        }
    }
    
    func startRecording() {
        screenRecorder.startCapture(handler: { sampleBuffer, bufferType, error in
            guard error == nil else {
                print("Error during capture: \(error!.localizedDescription)")
                return
            }
            
            if bufferType == .video {
                // Send the sampleBuffer (video frame) to the Android device over network here
                sendFrameToAndroid(sampleBuffer: sampleBuffer)
            }
            
        }, completionHandler: { error in
            if let error = error {
                print("Failed to start capture: \(error.localizedDescription)")
            } else {
                isRecording = true
            }
        })
    }
    
    func stopRecording() {
        screenRecorder.stopCapture { error in
            if let error = error {
                print("Error stopping capture: \(error.localizedDescription)")
            } else {
                isRecording = false
            }
        }
    }
    
    let screencastSender = ScreencastSender(ipAddress: "192.168.0.18", port: 7000) // Use the Android device's IP and chosen port

    func sendFrameToAndroid(sampleBuffer: CMSampleBuffer) {
        screencastSender.sendFrame(sampleBuffer: sampleBuffer)
    }
}

--- Fine del contenuto del file numero 1 ---

Ecco il nome del file numero 2:
--- ScreencastSender.swift ---
Contenuto del file numero 2:
---
import Network
import AVFoundation
import CoreImage
import UniformTypeIdentifiers


class ScreencastSender {
    private var connection: NWConnection?
    private let ipAddress: String
    private let port: UInt16

    init(ipAddress: String, port: UInt16) {
        self.ipAddress = ipAddress
        self.port = port
        setupConnection()
    }

    private func setupConnection() {
        let host = NWEndpoint.Host(ipAddress)
        let port = NWEndpoint.Port(integerLiteral: port)
        
        connection = NWConnection(host: host, port: port, using: .tcp)
        
        connection?.stateUpdateHandler = { state in
            switch state {
            case .ready:
                print("Connected to Android device")
            case .failed(let error):
                print("Connection failed: \(error.localizedDescription)")
            default:
                break
            }
        }
        
        connection?.start(queue: .global())
    }

    func sendFrame(sampleBuffer: CMSampleBuffer) {
        guard let connection = connection, connection.state == .ready else {
            print("Connection is not ready")
            return
        }
        
        guard let imageData = convertSampleBufferToJPEG(sampleBuffer) else {
            print("Failed to convert sample buffer to JPEG data")
            return
        }

        var dataSize = UInt32(imageData.count).bigEndian
        var dataWithSizePrefix = Data()
        dataWithSizePrefix.append(Data(bytes: &dataSize, count: MemoryLayout<UInt32>.size)) // Aggiungi la lunghezza in Big Endian
        dataWithSizePrefix.append(imageData)
        
        connection.send(content: dataWithSizePrefix, completion: .contentProcessed { error in
            if let error = error {
                print("Failed to send data: \(error.localizedDescription)")
            } else {
                print("Frame sent successfully")
            }
        })
    }

    private func convertSampleBufferToJPEG(_ sampleBuffer: CMSampleBuffer) -> Data? {
        guard let imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer) else {
            return nil
        }
        
        // Convert CVPixelBuffer to CGImage
        let ciImage = CIImage(cvPixelBuffer: imageBuffer)
        let context = CIContext()
        guard let cgImage = context.createCGImage(ciImage, from: ciImage.extent) else {
            return nil
        }
        
        // Create a mutable data object for JPEG output
        let jpegData = NSMutableData()
        guard let destination = CGImageDestinationCreateWithData(jpegData as CFMutableData, UTType.jpeg.identifier as CFString, 1, nil) else {
            return nil
        }
        
        // Set JPEG compression quality
        let options: [CFString: Any] = [kCGImageDestinationLossyCompressionQuality: 0.5]
        CGImageDestinationAddImage(destination, cgImage, options as CFDictionary)
        
        // Finalize the destination
        guard CGImageDestinationFinalize(destination) else {
            return nil
        }
        
        return jpegData as Data
    }

    func closeConnection() {
        connection?.cancel()
    }
}

--- Fine del contenuto del file numero 2 ---

Ecco il nome del file numero 3:
--- iCastApp.swift ---
Contenuto del file numero 3:
---
//
//  iCastApp.swift
//  iCast
//
//  Created by Daniele Della Cioppa on 15/10/2024.
//

import SwiftUI

@main
struct iCastApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}

--- Fine del contenuto del file numero 3 ---

